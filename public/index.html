<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluesky Alt Text Generator</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0085ff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Alt Text">
    <link rel="apple-touch-icon" href="/icons/full-bleed-icon-128.png">
    <!-- Security headers for SharedArrayBuffer support -->
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <!-- Disable caching for development -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="/css/style.css">
    <script>
        // Add cache-busting to CSS and scripts on page load
        document.addEventListener('DOMContentLoaded', () => {
            const timestamp = Date.now();
            
            // Update CSS link with cache-buster
            const cssLink = document.querySelector('link[href="/css/style.css"]');
            if (cssLink) {
                cssLink.href = `/css/style.css?v=${timestamp}`;
            }
            
            // Update script sources with cache-buster
            const scripts = document.querySelectorAll('script[src^="/"]');
            scripts.forEach(script => {
                const originalSrc = script.src;
                if (originalSrc && !originalSrc.includes('?v=')) {
                    script.src = `${originalSrc}?v=${timestamp}`;
                }
            });
        });
    </script>
</head>
<body>
    <!-- Development Banner -->
    <div class="dev-banner" id="dev-banner">
        <div class="dev-banner-content">
            <i class="fas fa-tools"></i>
            <span class="dev-banner-text">
                ‚ö†Ô∏è This site is in active development and may currently be unstable. 
                <a href="https://chromewebstore.google.com/detail/bdgpkmjnfildfjhpjagjibfnfpdieddp" target="_blank">Try our stable Chrome extension</a> for the best experience.
            </span>
            <button class="dev-banner-close" onclick="document.getElementById('dev-banner').style.display='none'">√ó</button>
        </div>
    </div>
    
    <header>
        <div class="theme-toggle" id="theme-toggle">
            <i class="theme-icon fas fa-sun"></i>
            <span class="theme-text">Light</span>
        </div>
        <div class="header-title">
            <img src="/icons/gen-alt-text.svg" alt="App Icon" class="app-icon">
            <h1>Bluesky Alt Text Generator</h1>
        </div>
        <p class="subtitle">Automatically generate detailed, accessible alt text & captions for your Bluesky images & videos using Google Gemini AI.</p>
    </header>

    <!-- Info Block -->
    <section class="info-block">
        <h3>üìã How it works & what you need to know</h3>
        <div class="info-grid">
            <div class="info-item">
                <h4>üìÅ Supported File Formats</h4>
                <ul>
                    <li>Images: JPEG, PNG, GIF, WebP, BMP</li>
                    <li>Videos: MP4, WebM, MOV, AVI, MKV</li>
                    <li>Animations: GIF, WebM, short MP4s</li>
                </ul>
            </div>
            <div class="info-item">
                <h4>‚öñÔ∏è File Size & Compression</h4>
                <p>Maximum file size: <strong>100MB</strong></p>
                <p>Files larger than 20MB are automatically compressed locally on your device before processing. This ensures faster uploads and processing while maintaining quality.</p>
            </div>
            <div class="info-item">
                <h4>‚ôø Why Alt Text & Captions Matter</h4>
                <p><strong>Alt text</strong> describes images for screen readers, helping visually impaired users understand visual content.</p>
                <p><strong>Captions</strong> provide video descriptions and dialogue transcription for accessibility and better engagement.</p>
            </div>
        </div>
    </section>

    <main class="container">
        <div class="main-content">
            <section class="upload-section">
                <div id="drop-area" class="upload-area">
                    <div class="upload-icon">üì∑</div>
                    <h3>Upload or Paste Media</h3>
                    <p>Drag & drop, click to browse, or paste from clipboard</p>
                    <input type="file" id="file-input" hidden accept="image/*,video/*">
                </div>
                <div class="preview-container" style="display: none;">
                    <h3>Preview</h3>
                    <!-- Preview will be inserted here -->
                </div>
                
                <!-- Options Section -->
                <div class="options-section" id="options-section" style="display: none;">
                    <h4>‚öôÔ∏è Generation Options</h4>
                    <div class="option-item">
                        <input type="checkbox" id="option-alt-text" checked>
                        <label for="option-alt-text">Generate & copy alt text to clipboard</label>
                    </div>
                    <div class="option-description">
                        Perfect for social media posts and accessibility
                    </div>
                    
                    <div class="option-item">
                        <input type="checkbox" id="option-captions">
                        <label for="option-captions">Generate & download captions file (.vtt)</label>
                    </div>
                    <div class="option-description">
                        Ideal for video content with dialogue or narration
                    </div>
                    
                    <div class="option-item" id="option-compression-item" style="display: none;">
                        <input type="checkbox" id="option-compression">
                        <label for="option-compression">Download compressed media file</label>
                    </div>
                    <div class="option-description" id="option-compression-desc" style="display: none;">
                        Get the compressed version of your large file
                    </div>
                </div>

                <div class="button-group">
                    <button id="generate-btn" disabled>üöÄ Generate</button>
                </div>
            </section>
            
            <section class="result-section">
                <h2>Generated Content</h2>
                
                <!-- Progress Container -->
                <div class="progress-container" id="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" id="progress-text">Initializing...</div>
                </div>
                
                <div class="status-box" id="status-message" style="display: none;">
                    Processing... Please wait.
                </div>
                <div class="result-box" id="result">
                    <p style="color: var(--text-muted);">Generated alt text and captions will appear here...</p>
                </div>
                <div class="button-group">
                    <button id="copy-btn" class="btn-secondary" disabled>üìã Copy to Clipboard</button>
                    <button id="download-btn" class="btn-secondary" style="display: none;" disabled>üíæ Download</button>
                </div>
            </section>
        </div>

        <!-- Collapsible Log Section -->
        <section class="log-section">
            <div class="log-header" id="log-header">
                <h2>Processing Logs</h2>
                <button class="log-toggle" id="log-toggle">‚ñº</button>
            </div>
            <div class="log-content" id="log-content">
                <div id="log-container" class="log-box"></div>
            </div>
        </section>
    </main>
    
    <footer>
        <div class="footer-links">
            <a href="https://chromewebstore.google.com/detail/bdgpkmjnfildfjhpjagjibfnfpdieddp" target="_blank" class="footer-link">
                <i class="fab fa-chrome"></i>
                <span>Chrome Extension</span>
            </a>
            <a href="https://addons.mozilla.org/en-US/firefox/addon/bluesky-alt-text-generator/" target="_blank" class="footer-link">
                <i class="fab fa-firefox-browser"></i>
                <span>Firefox Add-on</span>
            </a>
            <a href="https://bsky.app/profile/symm.app" target="_blank" class="footer-link">
                <svg class="bluesky-icon" viewBox="0 0 568 501" xmlns="http://www.w3.org/2000/svg">
                    <path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.209C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.889-129.52 80.986-149.07-65.72 11.185-139.6-7.295-159.875-79.748C9.945 203.66 0 75.293 0 57.947 0-28.906 76.134-1.611 123.121 33.664z"/>
                </svg>
                <span>@symm.app</span>
            </a>
            <a href="https://github.com/symmetricalboy/gen-alt-text" target="_blank" class="footer-link">
                <i class="fab fa-github"></i>
                <span>Open Source</span>
            </a>
        </div>
        <div class="footer-info">
            <p>Free & open source, for all, forever.</p>
            <p>Copyright ¬© 2025 Dylan Gregori Singer (symmetricalboy)</p>
        </div>
    </footer>

    <!-- Compression Warning Modal -->
    <div id="compression-modal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <button class="modal-close" id="modal-close">√ó</button>
            <h3>üîÑ Large File Processing Notice</h3>
            <p>While we can process media up to 100MB, files larger than 20MB must be compressed locally on your device before processing.</p>
            <p><strong>This process:</strong></p>
            <ul style="margin: 1rem 0; padding-left: 1.5rem; color: var(--text-secondary);">
                <li>Happens entirely on your machine (private & secure)</li>
                <li>May take 2-3 minutes for very large files</li>
                <li>Requires you to stay on this page during processing</li>
            </ul>
            <p>Ready to continue?</p>
            <div class="modal-checkbox">
                <input type="checkbox" id="dont-show-again">
                <label for="dont-show-again">Don't show this message again</label>
            </div>
            <div class="modal-buttons">
                <button id="modal-cancel" class="btn-secondary">Cancel</button>
                <button id="modal-continue">Continue</button>
            </div>
        </div>
    </div>
    
    <div id="ffmpeg-status"></div>
    <script src="/assets/ffmpeg/ffmpeg.min.js"></script>
    <script src="/js/main.js"></script>
    <script>
        // Development mode: Force cache clearing and fresh fetches
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    // First, unregister all existing service workers
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (let registration of registrations) {
                        console.log('Unregistering service worker:', registration.scope);
                        await registration.unregister();
                    }
                    
                    // Clear all caches
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        for (let cacheName of cacheNames) {
                            console.log('Deleting cache:', cacheName);
                            await caches.delete(cacheName);
                        }
                    }
                    
                    // Add cache-busting timestamp to all future requests
                    const timestamp = Date.now();
                    console.log('Cache bust timestamp:', timestamp);
                    
                    // Re-register service worker with cache-busting
                    const registration = await navigator.serviceWorker.register(`/service-worker.js?v=${timestamp}`);
                    console.log('ServiceWorker registration successful with scope:', registration.scope);
                    
                    // Force update
                    await registration.update();
                    
                } catch (err) {
                    console.log('ServiceWorker setup failed:', err);
                }
            });
        }
        
        // Add cache-busting to all resource requests
        window.addEventListener('beforeunload', () => {
            // Clear any remaining caches on page unload
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    cacheNames.forEach(cacheName => {
                        caches.delete(cacheName);
                    });
                });
            }
        });
    </script>
</body></html> 